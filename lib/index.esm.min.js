function h(e,i,t){let n=e.match(/#[\w\d_-]+/),s=e.match(/\.[\w\d_-]+/g)||[];s=s.map(e=>e.substring(1)),e=e.match(/^[\w\d]+/)[0];let l=document.createElement(e);if(n&&(l.id=n[0].substring(1)),Array.isArray(i))t=i;else if("object"==typeof i&&null!==i)for(const o in i)if("style"===o||"dataset"===o)for(const r in i[o])l[o][r]=i[o][r];else"classList"===o&&Array.isArray(i[o])?s=s.concat(i[o]):l[o]=i[o];else"string"!=typeof i&&"number"!=typeof i||(l.textContent=String(i));return s&&l.classList.add(...s),t&&t.forEach(e=>{e instanceof HTMLElement?l.appendChild(e):null!=e&&console.error(e,"not instance of HTMLElement")}),l}var config={cssId:"jacontextmenu-css",wrapperClassName:"jacontextmenu",defaultMenuWidth:200,menuItemHeight:24,menuItemDivideLineMargin:5,baseZIndex:1e3};class MenuItem{constructor(e,i,t){this.parentMenu=t,this.level=e,this.itemOption=i,this.init()}init(){const t=this.itemOption;"divide"===t.type||"---"===t.type?this.el=h("li.divide"):this.el=h("li",{classList:t.disabled?["disabled"]:[],onclick:e=>{var i;t.disabled||(i=this.parentMenu.payload,t.onclick&&t.onclick(e,i),t.children||this.parentMenu.closeAllMenus())},onmouseenter:t.children?e=>{this.showChildMenu(e)}:()=>{this.hideOtherChildMenu()}},[h("span.label",t.label),t.tip&&h("span.tip",t.tip),t.children&&h("span.right-arrow")]),t.children&&(t.children.width||(t.children.width=this.parentMenu.width),this.childMenu=new Menu(this.level+1,t.children))}showChildMenu(t){const n=this.childMenu.el;if(!t.target.contains(n)){t.target.classList.add(config.wrapperClassName+"_hover"),n.style.display="block";var s=parseFloat(getComputedStyle(n).height),t=t.target.getBoundingClientRect();let e=this.parentMenu.width-5,i=-2;window.innerWidth-t.x-this.parentMenu.width<this.childMenu.width&&(e=5-this.childMenu.width),window.innerWidth-t.y+2<s&&(i=-s+config.menuItemHeight+2+1),this.childMenu.removeChildMenus(),n.style.transform=`translate(${e}px, ${i}px)`}this.el.appendChild(n),this.childMenu.removeAllHover(),this.childMenu.payload=this.parentMenu.payload}hideOtherChildMenu(){var e;null!==(e=this.parentMenu)&&void 0!==e&&e.removeChildMenus(),null!==(e=this.parentMenu)&&void 0!==e&&e.removeItemHover()}}class Menu{constructor(e,i,t){this.height=0,this.children=[],this.level=e,this.items=i.items,this.width=i.width||config.defaultMenuWidth,this.innerOption=t,this.init(),this.addChildren(i.items)}init(){var e;this.el=h(`ul.${config.wrapperClassName}.${config.wrapperClassName}-lv`+this.level,{dataset:{lv:this.level},style:{width:this.width+"px",zIndex:+config.baseZIndex+this.level,position:null===(e=this.innerOption)||void 0===e?void 0:e.position},onclick:e=>e.stopPropagation(),oncontextmenu:e=>{e.stopPropagation(),e.preventDefault()}})}addChildren(e){if(!Array.isArray(e))return console.error("option.items is not type of array");for(const i of e)this.children.push(new MenuItem(this.level,i,this));this.children.forEach(e=>{this.el.appendChild(e.el)})}show(e,i){this.payload=i,e.preventDefault(),e.stopPropagation(),this.removeAllHover(),this.removeChildMenus(),this.calcPosition(e),this.el.style.display="block"}calcPosition(e){var i=window.outerWidth-window.innerWidth;this.height=parseFloat(getComputedStyle(this.el).height);let t=e.clientX,n=e.clientY+(0!==this.level||this.innerOption.position?0:window.scrollY);window.innerWidth-e.clientX-i<this.width&&(t=e.clientX-this.width),window.innerHeight-e.clientY-i<this.height&&(n=e.clientY-this.height),this.el.style.transform=`translate(${t}px,${n}px)`}hide(){this.el.style.display="none"}removeAllHover(){this.children.forEach(e=>{e.el.classList.remove(config.wrapperClassName+"_hover")})}removeChildMenus(){this.children.forEach(e=>{null!==(e=e.childMenu)&&void 0!==e&&e.el.remove()})}removeItemHover(){this.children.forEach(e=>{e.el.classList.remove(config.wrapperClassName+"_hover")})}closeAllMenus(){let e=document.querySelectorAll("."+config.wrapperClassName);e.forEach(e=>{0<+e.dataset.lv?e.remove():e.style.display="none"})}}const _cssStr=`
  .${config.wrapperClassName}, .${config.wrapperClassName} *{
    box-sizing: border-box;
  }
  .${config.wrapperClassName}{
    -webkit-user-select:none;
    user-select: none;
    border: 1px solid #ddd;
    left: 0;top:0;
    background-color: #fff;
    padding: 2px 0 2px 0px;
    margin: 0;
    cursor: default;
    width: ${config.defaultMenuWidth}px;
    display: none;
  }
  /*主菜单*/
  .${config.wrapperClassName}[data-lv="0"]{ 
    position: absolute;
  }
  /*子菜单*/
  .${config.wrapperClassName} .${config.wrapperClassName}{ 
    position: absolute;
  }
  .${config.wrapperClassName} .divide{
    margin: ${config.menuItemDivideLineMargin}px 0;
    height: 1px;
    background-color: #ddd;
  }
  .${config.wrapperClassName} li {
    position: relative;
    padding: 0 30px 0 30px;
    list-style: none;
    line-height: ${config.menuItemHeight}px;
    font-size: 13px;
    display: flex;
    justify-content: space-between;
    flex-wrap: nowrap;
  }
  .${config.wrapperClassName} li.disabled{
    color: #aaa;
    pointer-events: none;
  }
  .${config.wrapperClassName} li span.label {
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .${config.wrapperClassName} li span.tip{
    color:#aaa;
    font-size: 12px;
  }
  .${config.wrapperClassName} li:hover:not(.divide):not(.disabled),
  .${config.wrapperClassName} li.${config.wrapperClassName}_hover{
    background-color: #eee;
  }
  .${config.wrapperClassName} li:hover:not(.divide):not(.disabled) .tip,
  .${config.wrapperClassName} li.${config.wrapperClassName}_hover .tip{
    color: #000;
  }
  .${config.wrapperClassName} li .right-arrow {
    position: absolute;
    right: 8px;
    top: 9px;
    border-top: 4px solid rgba(0,0,0,0);
    border-left: 4px solid #000;
    border-right: 4px solid rgba(0,0,0,0);
    border-bottom: 4px solid rgba(0,0,0,0);
  }
  .${config.wrapperClassName}_child{
  }
  `;class ContextMenu{constructor(e){this.storeMenus=[],this.injectCss(),this.hideMenuEventListener();this.option=Object.assign({fixMenuWhenScroll:!1,hideMenuWhenScroll:!0},e),this.option.hideMenuWhenScroll&&this.scrollListener()}injectCss(){var e;(e=document.querySelector("#"+config.cssId))||(e=h("style#"+config.cssId,{innerHTML:_cssStr}),document.head.appendChild(e))}hideMenuEventListener(){this.clickEventFunc||(this.clickEventFunc=()=>{this.storeMenus.some(e=>"block"===e.el.style.display)&&this.hideAllMenu()},window.addEventListener("click",this.clickEventFunc,{capture:!0}))}scrollListener(){window.addEventListener("scroll",()=>{this.hideAllMenu()})}create(e){let i={};this.option.fixMenuWhenScroll&&(i.position="fixed");const t=new Menu(0,e,i);return this.storeMenus.push(t),document.body.appendChild(t.el),{show:(e,i)=>{this.showMenu(e,t,i)}}}showMenu(e,i,t){this.storeMenus.forEach(e=>{e.hide()}),i.show(e,t)}hideAllMenu(){this.storeMenus.forEach(e=>{e.el.style.display="none"})}}export{ContextMenu as default};
//# sourceMappingURL=index.esm.min.js.map
