function e(e,t,n){const i=e.match(/#[\w\d_-]+/);let s=e.match(/\.[\w\d_-]+/g)||[];s=s.map((e=>e.substring(1))),e=e.match(/^[\w\d]+/)[0];const l=document.createElement(e);if(i&&(l.id=i[0].substring(1)),Array.isArray(t))n=t;else if("object"==typeof t&&null!==t)for(const e in t)if("style"===e||"dataset"===e)for(const n in t[e])l[e][n]=t[e][n];else"classList"===e&&Array.isArray(t[e])?s=s.concat(t[e]):l[e]=t[e];else"string"!=typeof t&&"number"!=typeof t||(l.textContent=String(t));return s&&l.classList.add(...s),n&&n.forEach((e=>{e instanceof HTMLElement?l.appendChild(e):null!=e&&console.error(e,"not instance of HTMLElement")})),l}var t="ja-contextmenu-css",n="ja-panel",i="ja-contextmenu",s=200,l=24,o=5,h=1e3;let r;function d(){const e=document.querySelector("html"),t={htmlEl:e,scrollWidth:window.innerWidth-e.clientWidth,scrollHeight:window.innerHeight-e.clientHeight,clientWidth:e.clientWidth,clientHeight:e.clientHeight};return r=t,t}function a(e,t){return"function"==typeof e?e(t):e}d(),window.addEventListener("resize",(()=>{d()}));class c{constructor(e,t,n){this.parentMenu=n,this.level=e,this.itemOption=t,this.init()}init(){const t=this.itemOption;if("hr"===t.type||"---"===t.type)this.el=e("li.divide");else{const n=[],i=a(t.disabled,this.parentMenu.payload);t.disabled&&n.push("disabled");const s=a(t.class,this.parentMenu.payload);s&&n.push(s),this.el=e("li",{classList:n,onclick:e=>{i||(t.onclick&&t.onclick(e,this.parentMenu.payload),t.children||this.parentMenu.closeAllMenus())},onmouseenter:t.children?e=>{this.showChildMenu(e)}:()=>{this.hideOtherChildMenu()}},[t.icon&&e("img.menu-item-icon",{src:a(t.icon,this.parentMenu.payload)}),t.customItem?t.customItem:e("span.menu-item-label",{textContent:a(t.label,this.parentMenu.payload)}),t.tip&&e("span.menu-item-tip",a(t.tip,this.parentMenu.payload)),t.children&&e("span.right-arrow")])}if(t.children){const e={width:t.children.width||this.parentMenu.width};this.childMenu=new u(this.level+1,t.children,e)}}showChildMenu(e){const t=this.childMenu.el;e.target.contains(t)||(e.target.classList.add(i+"_hover"),t.style.display="block"),this.el.appendChild(t),this.childMenu.payload=this.parentMenu.payload,this.childMenu.show(e,this.childMenu.payload),this.calcPosition(e)}calcPosition(e){const t=this.childMenu.el,n=parseFloat(getComputedStyle(t).height),i=e.target.getBoundingClientRect();let s=this.parentMenu.width-5,o=-2;r.clientWidth-i.x-this.parentMenu.width<this.childMenu.width&&(s=5-this.childMenu.width),r.clientHeight-i.y+2<n&&(o=-n+l+2+1),t.style.transform=`translate(${s}px, ${o}px)`}hideOtherChildMenu(){var e,t;null===(e=this.parentMenu)||void 0===e||e.removeChildMenus(),null===(t=this.parentMenu)||void 0===t||t.removeItemHover()}}class p{constructor(e){var t;this.height=0,this.panelOption=e,this.width=(null===(t=this.panelOption)||void 0===t?void 0:t.width)||s,this.createEl(),this.addEvnetListener()}createEl(){var t;this.el=e(`div.${n}`,{style:{width:this.width+"px",zIndex:+h,position:null===(t=this.panelOption)||void 0===t?void 0:t.position}})}addEvnetListener(){this.el.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation()})),this.el.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation()}))}show(e){e instanceof MouseEvent&&(e.preventDefault(),e.stopPropagation()),this.el.style.display="block";const{x:t,y:n}=this.calcPosition(e);this.el.style.transform=`translate(${t}px,${n}px)`}calcPosition(e){this.height=parseFloat(getComputedStyle(this.el).height);let t=e.x,n=e.y;return r.clientWidth-e.x<this.width&&(t=r.clientWidth-this.width),r.clientHeight-e.y<this.height&&(n=e.y-this.height),{x:t,y:n}}hide(){this.el.style.display="none"}destroy(){this.el.remove(),this.el=null}}class u extends p{constructor(e,t,n={}){super(n),this.children=[],this.menuOption=t,this.level=e,this.createUl()}createUl(){this.ul=e("ul",{classList:[i,`${i}-lv${this.level}`],dataset:{lv:this.level},style:{zIndex:+h+this.level},onclick:e=>e.stopPropagation(),oncontextmenu:e=>{e.stopPropagation(),e.preventDefault()}}),this.el.appendChild(this.ul)}updateMenuAttr(){this.ul.className=`${i} ${i}-lv${this.level} ${a(this.menuOption.class,this.payload)}`}renderMenuItem(){if(!Array.isArray(this.menuOption.items))return console.error("option.items is not type of array");let e;for(this.children=[];e=this.ul.lastChild;)e.remove();for(const e of this.menuOption.items)this.children.push(new c(this.level,e,this));this.children.forEach((e=>{this.ul.appendChild(e.el)}))}show(e,t){this.payload=t,this.removeAllHover(),this.removeChildMenus(),this.updateMenuAttr(),this.renderMenuItem(),super.show(e)}calcPosition(e){let{x:t,y:n}=super.calcPosition(e);return 0===this.level&&"fixed"!==this.panelOption.position&&(t+=window.scrollX,n+=window.scrollY),{x:t,y:n}}removeAllHover(){this.children.forEach((e=>{e.el.classList.remove(`${i}_hover`)}))}removeChildMenus(){this.children.forEach((e=>{var t;null===(t=e.childMenu)||void 0===t||t.el.remove()}))}removeItemHover(){this.children.forEach((e=>{e.el.classList.remove(`${i}_hover`)}))}closeAllMenus(){document.querySelectorAll(`.${n}`).forEach((e=>{+e.dataset.lv>0?e.remove():e.style.display="none"}))}destroy(){this.el.remove(),this.el=null,this.menuOption=null,this.children=[],this.payload=null}}const m=`\n  .${n}, .${n} * {\n    box-sizing: border-box;\n  }\n  .${n}{\n    border: 1px solid #ddd;\n    left: 0;top:0;\n    background-color: #fff;\n    display: none;\n    width: ${s}px;\n    position:absolute;\n  }\n`,v=`\n  .${i}{\n    -webkit-user-select:none;\n    user-select: none;\n    padding: 2px 0 2px 0px;\n    margin: 0;\n    cursor: default;\n  }\n  /*子菜单*/\n  .${i} .${n}{ \n    position: absolute;\n  }\n  .${i} .divide{\n    margin: ${o}px 0;\n    height: 1px;\n    background-color: #ddd;\n  }\n  .${i} li {\n    position: relative;\n    padding: 0 30px 0 30px;\n    list-style: none;\n    line-height: ${l}px;\n    font-size: 13px;\n    display: flex;\n    justify-content: space-between;\n    flex-wrap: nowrap;\n  }\n  .${i} li.disabled{\n    color: #aaa;\n    pointer-events: none;\n  }\n  .${i} li .menu-item-icon{\n    position:absolute;\n    left: 7px;\n    top: 4px;\n    height: 16px;\n    vertical-align: middle;\n  }\n  .${i} li span.menu-item-label {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .${i} li span.menu-item-tip{\n    color:#aaa;\n    font-size: 12px;\n  }\n  .${i} li:hover:not(.divide):not(.disabled),\n  .${i} li.${i}_hover{\n    background-color: #eee;\n  }\n  .${i} li:hover:not(.divide):not(.disabled) .tip,\n  .${i} li.${i}_hover .tip{\n    color: #000;\n  }\n  .${i} li .right-arrow {\n    position: absolute;\n    right: 8px;\n    top: 9px;\n    border-top: 4px solid transparent;\n    border-left: 4px solid #000;\n    border-right: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n  }\n  .${i}_child{\n  }\n  `;class y{constructor(e={}){this.storeMenus=[],this.injectCss(),this.hideMenuEventListener();const t={width:s,fixMenuWhenScroll:!1,hideMenuWhenScroll:!0};this.contextMenuOption=Object.assign(t,e),this.contextMenuOption.hideMenuWhenScroll&&this.scrollListener()}injectCss(){const n=document.querySelector("head title");let i=document.querySelector(`#${t}`);i||(i=e(`style#${t}`,{innerHTML:m+v}),n?document.head.insertBefore(i,n.nextElementSibling):document.head.appendChild(i))}hideMenuEventListener(){this.clickEventFunc||(this.clickEventFunc=()=>{this.storeMenus.some((e=>"block"===e.el.style.display))&&this.hideAllMenu()},window.addEventListener("click",this.clickEventFunc,{capture:!0}))}scrollListener(){window.addEventListener("scroll",(()=>{this.hideAllMenu()}))}create(e){const t={width:e.width||this.contextMenuOption.width};this.contextMenuOption.fixMenuWhenScroll&&(t.position="fixed");const n=new u(0,e,t);return this.storeMenus.push(n),document.body.appendChild(n.el),{show:(e,t)=>{this.showMenu(e,n,t)},destroy:()=>{this.destroy(n)}}}showMenu(e,t,n){this.storeMenus.forEach((e=>{e.hide()})),t.show(e,n)}hideAllMenu(){this.storeMenus.forEach((e=>{e.el.style.display="none"}))}destroy(e){e.destroy();for(let t=0;t<this.storeMenus.length;t++){if(this.storeMenus[t]===e){this.storeMenus[t]=null;break}}this.storeMenus=this.storeMenus.filter(Boolean)}}export{p as Panel,y as default,e as h};
//# sourceMappingURL=index.esm.min.js.map
