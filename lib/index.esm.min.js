function h(e,t,i){var n=e.match(/#[\w\d_-]+/);let s=e.match(/\.[\w\d_-]+/g)||[];s=s.map(e=>e.substring(1)),e=e.match(/^[\w\d]+/)[0];const l=document.createElement(e);if(n&&(l.id=n[0].substring(1)),Array.isArray(t))i=t;else if("object"==typeof t&&null!==t)for(const o in t)if("style"===o||"dataset"===o)for(const a in t[o])l[o][a]=t[o][a];else"classList"===o&&Array.isArray(t[o])?s=s.concat(t[o]):l[o]=t[o];else"string"!=typeof t&&"number"!=typeof t||(l.textContent=String(t));return s&&l.classList.add(...s),i&&i.forEach(e=>{e instanceof HTMLElement?l.appendChild(e):null!=e&&console.error(e,"not instance of HTMLElement")}),l}var config={cssId:"ja-contextmenu-css",panelClassName:"ja-panel",wrapperClassName:"ja-contextmenu",defaultMenuWidth:200,menuItemHeight:24,menuItemDivideLineMargin:5,baseZIndex:1e3};let _storeWindowSize;function getWindowSize(){var e=document.querySelector("html"),e={htmlEl:e,scrollWidth:window.innerWidth-e.clientWidth,scrollHeight:window.innerHeight-e.clientHeight,clientWidth:e.clientWidth,clientHeight:e.clientHeight};return _storeWindowSize=e}function dealTextFmt(e,t){return"function"==typeof e?e(t):e}getWindowSize(),window.addEventListener("resize",()=>{getWindowSize()});class MenuItem{constructor(e,t,i){this.parentMenu=i,this.level=e,this.itemOption=t,this.init()}init(){const t=this.itemOption;var e,i;"hr"===t.type||"---"===t.type?this.el=h("li.divide"):(e=[],t.disabled&&e.push("disabled"),(i=dealTextFmt(t.class,this.parentMenu.payload))&&e.push(i),this.el=h("li",{classList:e,onclick:e=>{t.disabled||(t.onclick&&t.onclick(e,this.parentMenu.payload),t.children||this.parentMenu.closeAllMenus())},onmouseenter:t.children?e=>{this.showChildMenu(e)}:()=>{this.hideOtherChildMenu()}},[t.icon&&h("img.menu-item-icon",{src:dealTextFmt(t.icon,this.parentMenu.payload)}),t.customItem||h("span.menu-item-label",{textContent:dealTextFmt(t.label,this.parentMenu.payload)}),t.tip&&h("span.menu-item-tip",dealTextFmt(t.tip,this.parentMenu.payload)),t.children&&h("span.right-arrow")])),t.children&&(i={width:t.children.width||this.parentMenu.width},this.childMenu=new Menu(this.level+1,t.children,i))}showChildMenu(e){var t=this.childMenu.el;e.target.contains(t)||(e.target.classList.add(config.wrapperClassName+"_hover"),t.style.display="block"),this.el.appendChild(t),this.calcPosition(e),this.childMenu.removeAllHover(),this.childMenu.payload=this.parentMenu.payload}calcPosition(e){var t=this.childMenu.el,i=parseFloat(getComputedStyle(t).height),e=e.target.getBoundingClientRect();let n=this.parentMenu.width-5,s=-2;_storeWindowSize.clientWidth-e.x-this.parentMenu.width<this.childMenu.width&&(n=5-this.childMenu.width),_storeWindowSize.clientHeight-e.y+2<i&&(s=-i+config.menuItemHeight+2+1),this.childMenu.removeChildMenus(),t.style.transform=`translate(${n}px, ${s}px)`}hideOtherChildMenu(){var e;null!=(e=this.parentMenu)&&e.removeChildMenus(),null!=(e=this.parentMenu)&&e.removeItemHover()}}class Panel{constructor(e){this.height=0,this.panelOption=e,this.width=(null==e?void 0:e.width)||config.defaultMenuWidth,this.el=h("div."+config.panelClassName,{style:{width:this.width+"px",zIndex:+config.baseZIndex,position:null==(e=this.panelOption)?void 0:e.position}}),this.el.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation()}),this.el.addEventListener("contextmenu",e=>{e.preventDefault(),e.stopPropagation()})}show(e){e instanceof MouseEvent&&(e.preventDefault(),e.stopPropagation()),this.el.style.display="block";var{x:e,y:t}=this.calcPosition(e);this.el.style.transform=`translate(${e}px,${t}px)`}calcPosition(e){this.height=parseFloat(getComputedStyle(this.el).height);let t=e.x,i=e.y;return _storeWindowSize.clientWidth-e.x<this.width&&(t=_storeWindowSize.clientWidth-this.width),_storeWindowSize.clientHeight-e.y<this.height&&(i=e.y-this.height),{x:t,y:i}}hide(){this.el.style.display="none"}destroy(){this.el.remove(),this.el=null}}class Menu extends Panel{constructor(e,t,i={}){super(i),this.children=[],this.menuOption=t,this.level=e,this.init(),this.renderMenuItem()}init(){this.ul=h("ul",{classList:[config.wrapperClassName,config.wrapperClassName+"-lv"+this.level],dataset:{lv:this.level},style:{zIndex:+config.baseZIndex+this.level},onclick:e=>e.stopPropagation(),oncontextmenu:e=>{e.stopPropagation(),e.preventDefault()}}),this.el.appendChild(this.ul)}updateMenuAttr(){this.ul.className=`${config.wrapperClassName} ${config.wrapperClassName}-lv${this.level} `+dealTextFmt(this.menuOption.class,this.payload)}renderMenuItem(){if(!Array.isArray(this.menuOption.items))return console.error("option.items is not type of array");var e;for(this.children=[];e=this.ul.lastChild;)e.remove();for(const t of this.menuOption.items)this.children.push(new MenuItem(this.level,t,this));this.children.forEach(e=>{this.ul.appendChild(e.el)})}show(e,t){this.payload=t,this.removeAllHover(),this.removeChildMenus(),this.updateMenuAttr(),this.renderMenuItem(),super.show(e)}calcPosition(e){let{x:t,y:i}=super.calcPosition(e);return 0===this.level&&"fixed"!==this.panelOption.position&&(t+=window.scrollX,i+=window.scrollY),{x:t,y:i}}removeAllHover(){this.children.forEach(e=>{e.el.classList.remove(config.wrapperClassName+"_hover")})}removeChildMenus(){this.children.forEach(e=>{null!=(e=e.childMenu)&&e.el.remove()})}removeItemHover(){this.children.forEach(e=>{e.el.classList.remove(config.wrapperClassName+"_hover")})}closeAllMenus(){document.querySelectorAll("."+config.panelClassName).forEach(e=>{0<+e.dataset.lv?e.remove():e.style.display="none"})}destroy(){this.el.remove(),this.el=null,this.menuOption=null,this.children=[],this.payload=null}}const panelStyle=`
  .${config.panelClassName}, .${config.panelClassName} * {
    box-sizing: border-box;
  }
  .${config.panelClassName}{
    border: 1px solid #ddd;
    left: 0;top:0;
    background-color: #fff;
    display: none;
    width: ${config.defaultMenuWidth}px;
    position:absolute;
  }
`,contextMenuStyle=`
  .${config.wrapperClassName}{
    -webkit-user-select:none;
    user-select: none;
    padding: 2px 0 2px 0px;
    margin: 0;
    cursor: default;
  }
  /*子菜单*/
  .${config.wrapperClassName} .${config.panelClassName}{ 
    position: absolute;
  }
  .${config.wrapperClassName} .divide{
    margin: ${config.menuItemDivideLineMargin}px 0;
    height: 1px;
    background-color: #ddd;
  }
  .${config.wrapperClassName} li {
    position: relative;
    padding: 0 30px 0 30px;
    list-style: none;
    line-height: ${config.menuItemHeight}px;
    font-size: 13px;
    display: flex;
    justify-content: space-between;
    flex-wrap: nowrap;
  }
  .${config.wrapperClassName} li.disabled{
    color: #aaa;
    pointer-events: none;
  }
  .${config.wrapperClassName} li .menu-item-icon{
    position:absolute;
    left: 7px;
    top: 4px;
    height: 16px;
    vertical-align: middle;
  }
  .${config.wrapperClassName} li span.menu-item-label {
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .${config.wrapperClassName} li span.menu-item-tip{
    color:#aaa;
    font-size: 12px;
  }
  .${config.wrapperClassName} li:hover:not(.divide):not(.disabled),
  .${config.wrapperClassName} li.${config.wrapperClassName}_hover{
    background-color: #eee;
  }
  .${config.wrapperClassName} li:hover:not(.divide):not(.disabled) .tip,
  .${config.wrapperClassName} li.${config.wrapperClassName}_hover .tip{
    color: #000;
  }
  .${config.wrapperClassName} li .right-arrow {
    position: absolute;
    right: 8px;
    top: 9px;
    border-top: 4px solid transparent;
    border-left: 4px solid #000;
    border-right: 4px solid transparent;
    border-bottom: 4px solid transparent;
  }
  .${config.wrapperClassName}_child{
  }
  `;class ContextMenu{constructor(e={}){this.storeMenus=[],this.injectCss(),this.hideMenuEventListener();var t={width:config.defaultMenuWidth,fixMenuWhenScroll:!1,hideMenuWhenScroll:!0};this.contextMenuOption=Object.assign(t,e),this.contextMenuOption.hideMenuWhenScroll&&this.scrollListener()}injectCss(){var e,t=document.querySelector("head title");document.querySelector("#"+config.cssId)||(e=h("style#"+config.cssId,{innerHTML:panelStyle+contextMenuStyle}),t?document.head.insertBefore(e,t.nextElementSibling):document.head.appendChild(e))}hideMenuEventListener(){this.clickEventFunc||(this.clickEventFunc=()=>{this.storeMenus.some(e=>"block"===e.el.style.display)&&this.hideAllMenu()},window.addEventListener("click",this.clickEventFunc,{capture:!0}))}scrollListener(){window.addEventListener("scroll",()=>{this.hideAllMenu()})}create(e){var t={width:e.width||this.contextMenuOption.width};this.contextMenuOption.fixMenuWhenScroll&&(t.position="fixed");const i=new Menu(0,e,t);return this.storeMenus.push(i),document.body.appendChild(i.el),{show:(e,t)=>{this.showMenu(e,i,t)},destroy:()=>{this.destroy(i)}}}showMenu(e,t,i){this.storeMenus.forEach(e=>{e.hide()}),t.show(e,i)}hideAllMenu(){this.storeMenus.forEach(e=>{e.el.style.display="none"})}destroy(t){t.destroy();for(let e=0;e<this.storeMenus.length;e++)if(this.storeMenus[e]===t){this.storeMenus[e]=null;break}this.storeMenus=this.storeMenus.filter(Boolean)}}export{Panel,ContextMenu as default,h};
//# sourceMappingURL=index.esm.min.js.map
