function _createForOfIteratorHelper(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||n&&e&&"number"==typeof e.length){t&&(e=t);function i(){}var o=0;return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){l=!0,r=e},f:function(){try{a||null==t.return||t.return()}finally{if(l)throw r}}}}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,n,t){var i=e.match(/#[\w\d_-]+/),o=(o=e.match(/\.[\w\d_-]+/g)||[]).map(function(e){return e.substring(1)});e=e.match(/^[\w\d]+/)[0];var r=document.createElement(e);if(i&&(r.id=i[0].substring(1)),Array.isArray(n))t=n;else if("object"===_typeof(n)&&null!==n)for(var a in n)if("style"===a||"dataset"===a)for(var l in n[a])r[a][l]=n[a][l];else"classList"===a&&Array.isArray(n[a])?o=o.concat(n[a]):r[a]=n[a];else"string"!=typeof n&&"number"!=typeof n||(r.textContent=String(n));return o&&(i=r.classList).add.apply(i,_toConsumableArray(o)),t&&t.forEach(function(e){e instanceof HTMLElement?r.appendChild(e):null!=e&&console.error(e,"not instance of HTMLElement")}),r}var _storeWindowSize,config={cssId:"jacontextmenu-css",wrapperClassName:"jacontextmenu",defaultMenuWidth:200,menuItemHeight:24,menuItemDivideLineMargin:5,baseZIndex:1e3};function getWindowSize(){var e=document.querySelector("html"),e={htmlEl:e,scrollWidth:window.innerWidth-e.clientWidth,scrollHeight:window.innerHeight-e.clientHeight,clientWidth:e.clientWidth,clientHeight:e.clientHeight};return _storeWindowSize=e}getWindowSize(),window.addEventListener("resize",function(){console.log("get getWindowSize"),getWindowSize()});var MenuItem=function(){function i(e,n,t){_classCallCheck(this,i),this.parentMenu=t,this.level=e,this.itemOption=n,this.init()}return _createClass(i,[{key:"init",value:function(){var t=this,i=this.itemOption;"divide"===i.type||"---"===i.type?this.el=h("li.divide"):this.el=h("li",{classList:i.disabled?["disabled"]:[],onclick:function(e){var n;i.disabled||(n=t.parentMenu.payload,i.onclick&&i.onclick(e,n),i.children||t.parentMenu.closeAllMenus())},onmouseenter:i.children?function(e){t.showChildMenu(e)}:function(){t.hideOtherChildMenu()}},[h("span.label",i.label),i.tip&&h("span.tip",i.tip),i.children&&h("span.right-arrow")]),i.children&&(i.children.width||(i.children.width=this.parentMenu.width),this.childMenu=new Menu(this.level+1,i.children))}},{key:"showChildMenu",value:function(e){var n=this.childMenu.el;e.target.contains(n)||(e.target.classList.add(config.wrapperClassName+"_hover"),n.style.display="block"),this.el.appendChild(n),this.calcPosition(e),this.childMenu.removeAllHover(),this.childMenu.payload=this.parentMenu.payload}},{key:"calcPosition",value:function(e){var n=this.childMenu.el,t=parseFloat(getComputedStyle(n).height),i=e.target.getBoundingClientRect(),o=this.parentMenu.width-5,e=-2;_storeWindowSize.clientWidth-i.x-this.parentMenu.width<this.childMenu.width&&(o=5-this.childMenu.width),_storeWindowSize.clientHeight-i.y+2<t&&(e=-t+config.menuItemHeight+2+1),this.childMenu.removeChildMenus(),n.style.transform="translate(".concat(o,"px, ").concat(e,"px)")}},{key:"hideOtherChildMenu",value:function(){var e;null!==(e=this.parentMenu)&&void 0!==e&&e.removeChildMenus(),null!==(e=this.parentMenu)&&void 0!==e&&e.removeItemHover()}}]),i}(),Menu=function(){function i(e,n,t){_classCallCheck(this,i),this.height=0,this.children=[],this.level=e,this.items=n.items,this.width=n.width||config.defaultMenuWidth,this.innerOption=t,this.init(),this.addChildren(n.items)}return _createClass(i,[{key:"init",value:function(){var e;this.el=h("ul.".concat(config.wrapperClassName,".").concat(config.wrapperClassName,"-lv").concat(this.level),{dataset:{lv:this.level},style:{width:this.width+"px",zIndex:+config.baseZIndex+this.level,position:null===(e=this.innerOption)||void 0===e?void 0:e.position},onclick:function(e){return e.stopPropagation()},oncontextmenu:function(e){e.stopPropagation(),e.preventDefault()}})}},{key:"addChildren",value:function(e){var n=this;if(!Array.isArray(e))return console.error("option.items is not type of array");var t,i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;this.children.push(new MenuItem(this.level,o,this))}}catch(e){i.e(e)}finally{i.f()}this.children.forEach(function(e){n.el.appendChild(e.el)})}},{key:"show",value:function(e,n){this.payload=n,e.preventDefault(),e.stopPropagation(),this.removeAllHover(),this.removeChildMenus(),this.el.style.display="block",this.calcPosition(e)}},{key:"calcPosition",value:function(e){this.height=parseFloat(getComputedStyle(this.el).height);var n=e.clientX,t=e.clientY;_storeWindowSize.clientWidth-e.clientX<this.width&&(n=_storeWindowSize.clientWidth-this.width),_storeWindowSize.clientHeight-e.clientY<this.height&&(t=e.clientY-this.height),0===this.level&&"fixed"!==this.innerOption.position&&(n+=window.scrollX,t+=window.scrollY),this.el.style.transform="translate(".concat(n,"px,").concat(t,"px)")}},{key:"hide",value:function(){this.el.style.display="none"}},{key:"removeAllHover",value:function(){this.children.forEach(function(e){e.el.classList.remove("".concat(config.wrapperClassName,"_hover"))})}},{key:"removeChildMenus",value:function(){this.children.forEach(function(e){null!==(e=e.childMenu)&&void 0!==e&&e.el.remove()})}},{key:"removeItemHover",value:function(){this.children.forEach(function(e){e.el.classList.remove("".concat(config.wrapperClassName,"_hover"))})}},{key:"closeAllMenus",value:function(){document.querySelectorAll(".".concat(config.wrapperClassName)).forEach(function(e){0<+e.dataset.lv?e.remove():e.style.display="none"})}}]),i}(),_cssStr="\n  .".concat(config.wrapperClassName,", .").concat(config.wrapperClassName," *{\n    box-sizing: border-box;\n  }\n  .").concat(config.wrapperClassName,"{\n    -webkit-user-select:none;\n    user-select: none;\n    border: 1px solid #ddd;\n    left: 0;top:0;\n    background-color: #fff;\n    padding: 2px 0 2px 0px;\n    margin: 0;\n    cursor: default;\n    width: ").concat(config.defaultMenuWidth,"px;\n    display: none;\n  }\n  /*主菜单*/\n  .").concat(config.wrapperClassName,'[data-lv="0"]{ \n    position: absolute;\n  }\n  /*子菜单*/\n  .').concat(config.wrapperClassName," .").concat(config.wrapperClassName,"{ \n    position: absolute;\n  }\n  .").concat(config.wrapperClassName," .divide{\n    margin: ").concat(config.menuItemDivideLineMargin,"px 0;\n    height: 1px;\n    background-color: #ddd;\n  }\n  .").concat(config.wrapperClassName," li {\n    position: relative;\n    padding: 0 30px 0 30px;\n    list-style: none;\n    line-height: ").concat(config.menuItemHeight,"px;\n    font-size: 13px;\n    display: flex;\n    justify-content: space-between;\n    flex-wrap: nowrap;\n  }\n  .").concat(config.wrapperClassName," li.disabled{\n    color: #aaa;\n    pointer-events: none;\n  }\n  .").concat(config.wrapperClassName," li span.label {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .").concat(config.wrapperClassName," li span.tip{\n    color:#aaa;\n    font-size: 12px;\n  }\n  .").concat(config.wrapperClassName," li:hover:not(.divide):not(.disabled),\n  .").concat(config.wrapperClassName," li.").concat(config.wrapperClassName,"_hover{\n    background-color: #eee;\n  }\n  .").concat(config.wrapperClassName," li:hover:not(.divide):not(.disabled) .tip,\n  .").concat(config.wrapperClassName," li.").concat(config.wrapperClassName,"_hover .tip{\n    color: #000;\n  }\n  .").concat(config.wrapperClassName," li .right-arrow {\n    position: absolute;\n    right: 8px;\n    top: 9px;\n    border-top: 4px solid rgba(0,0,0,0);\n    border-left: 4px solid #000;\n    border-right: 4px solid rgba(0,0,0,0);\n    border-bottom: 4px solid rgba(0,0,0,0);\n  }\n  .").concat(config.wrapperClassName,"_child{\n  }\n  "),ContextMenu=function(){function n(e){_classCallCheck(this,n),this.storeMenus=[],this.injectCss(),this.hideMenuEventListener();this.option=Object.assign({fixMenuWhenScroll:!1,hideMenuWhenScroll:!0},e),this.option.hideMenuWhenScroll&&this.scrollListener()}return _createClass(n,[{key:"injectCss",value:function(){var e;(e=document.querySelector("#".concat(config.cssId)))||(e=h("style#".concat(config.cssId),{innerHTML:_cssStr}),document.head.appendChild(e))}},{key:"hideMenuEventListener",value:function(){var e=this;this.clickEventFunc||(this.clickEventFunc=function(){e.storeMenus.some(function(e){return"block"===e.el.style.display})&&e.hideAllMenu()},window.addEventListener("click",this.clickEventFunc,{capture:!0}))}},{key:"scrollListener",value:function(){var e=this;window.addEventListener("scroll",function(){e.hideAllMenu()})}},{key:"create",value:function(e){var t=this,n={};this.option.fixMenuWhenScroll&&(n.position="fixed");var i=new Menu(0,e,n);return this.storeMenus.push(i),document.body.appendChild(i.el),{show:function(e,n){t.showMenu(e,i,n)}}}},{key:"showMenu",value:function(e,n,t){this.storeMenus.forEach(function(e){e.hide()}),n.show(e,t)}},{key:"hideAllMenu",value:function(){this.storeMenus.forEach(function(e){e.el.style.display="none"})}}]),n}();export{ContextMenu as default};
//# sourceMappingURL=index.es5.min.js.map
