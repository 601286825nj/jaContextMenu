var e="ja-panel-css",t="ja-contextmenu-css",i="ja-panel",n="ja-contextmenu",s=200,o=24,l=5,r=5e3;function h(e,t,i){const n=e.match(/^[\w\d]+/);if(!n)throw new Error("invalid tag");const s=n[0],o=e.match(/#[\w\d_-]+/);let l=e.match(/\.[\w\d_-]+/g)||[];l=Array.from(l).map((e=>e.substring(1)));const r=document.createElement(s);if(o&&(r.id=o[0].substring(1)),Array.isArray(t))i=t;else if("object"==typeof t&&null!==t)for(const e in t)if("style"===e||"dataset"===e){const i=t[e];for(const t in i)r[e][t]=i[t]}else"classList"===e&&Array.isArray(t.classList)?l=l.concat(t.classList.filter(Boolean)):r[e]=t[e];else"string"!=typeof t&&"number"!=typeof t||(r.textContent=String(t));return l.length&&r.classList.add(...l),i&&i.forEach((e=>{e&&(e instanceof HTMLElement?r.appendChild(e):console.error(e,"not instance of HTMLElement"))})),r}let d;function a(){const e=document.querySelector("html"),{innerWidth:t,innerHeight:i}=window,{clientWidth:n,clientHeight:s}=e;return d={htmlEl:e,sW:t-n,sH:i-s,cW:n,cH:s},d}function c(e,t){return"function"==typeof e?e(t):e||""}function p(e,t){let i=document.getElementById(e);if(!i){i=h(`style#${e}`,{innerHTML:t});const n=document.querySelector("head title");n?document.head.insertBefore(i,n.nextElementSibling):document.head.appendChild(i)}}a(),window.addEventListener("resize",(()=>{a()}));class u{constructor(e,t,i){this.parentMenu=i,this.level=e,this.itemOption=t,this.init()}init(){const e=this.itemOption;if("hr"===e.type||"---"===e.type)this.el=h("li.divide");else{const t=c(e.disabled,this.parentMenu.payload),i=[c(e.class,this.parentMenu.payload)];t&&i.push("disabled");const n=void 0===e.show||c(e.show,this.parentMenu.payload);let s;if(e.icon){const t=c(e.icon,this.parentMenu.payload);s=t instanceof HTMLElement?h("div.menu-item-icon",[t]):h("img.menu-item-icon",{src:t})}this.el=h("li",{style:{display:n?"":"none"},classList:i,onclick:i=>{var n;if(!t){const t=null===(n=e.onclick)||void 0===n?void 0:n.call(e,i,this.parentMenu.payload);e.children||t||this.parentMenu.closeAllMenus()}},onmouseenter:e.children?e=>{this.showChildMenu(e)}:()=>{this.hideOtherChildMenu()}},[s,c(e.customItem,this.parentMenu.payload)||h("span.menu-item-label",{textContent:c(e.label,this.parentMenu.payload)}),e.tip&&h("span.menu-item-tip",c(e.tip,this.parentMenu.payload)),e.children&&h("span.right-arrow")])}e.children&&(e.children.width||(e.children.width=this.parentMenu.width),this.childMenu=new M(e.children,{level:this.level+1,id:this.parentMenu.id}))}showChildMenu(e){const t=this.childMenu.el;e.target.contains(t)||(e.target.classList.add(n+"_hover"),t.classList.remove("hide")),document.body.appendChild(t),this.childMenu.payload=this.parentMenu.payload,this.childMenu.prepareMenuShow(this.childMenu.payload),this.calcPosition()}calcPosition(){const e=this.childMenu.el,{height:t}=e.getBoundingClientRect(),i=this.el.getBoundingClientRect(),n=this.parentMenu.width||s,o=this.childMenu.width||s;let l=i.x+i.width-5,r=i.y-3;d.cW-i.x-n<o&&(l=i.x-o+5),t>=d.cH?(r=0,e.style.maxHeight=`${d.cH}px`,e.classList.add("scroll")):d.cH-i.y+2<t&&(r=d.cH-t),e.style.top=`${r}px`,e.style.left=`${l}px`}hideOtherChildMenu(){var e,t;null===(e=this.parentMenu)||void 0===e||e.removeChildMenus(),null===(t=this.parentMenu)||void 0===t||t.removeItemHover()}}var v;!function(e){e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right"}(v||(v={}));class m{constructor(t){var n,s;if(this.height=0,this.panelOption=t,this.width=null===(n=this.panelOption)||void 0===n?void 0:n.width,"string"==typeof(null===(s=this.panelOption)||void 0===s?void 0:s.width))throw new TypeError("Invalid width type.");p(e,`\n  .${i}, .${i} * {\n    box-sizing: border-box;\n  }\n  .${i}{\n    --border-color: #dee0e3;\n    border: 1px solid var(--border-color);\n    left: 0; top: 0;\n    background-color: #fff;\n    position: absolute;\n    z-index: ${r};\n  }\n  .${i}.hide{\n    display: none;\n  }\n  .${i}.scroll{\n    overflow: auto;\n    overflow: overlay;\n  }\n`),this.createEl(),this.addEventListener()}createEl(){var e,t;this.el=h(`div.${i}`,{style:{width:this.width?this.width+"px":void 0,zIndex:null===(e=this.panelOption)||void 0===e?void 0:e.zIndex,position:null===(t=this.panelOption)||void 0===t?void 0:t.position},classList:["hide"]})}addEventListener(){var e,t;null===(e=this.el)||void 0===e||e.addEventListener("click",this.eventListenerCb),null===(t=this.el)||void 0===t||t.addEventListener("contextmenu",this.eventListenerCb)}eventListenerCb(e){e.preventDefault(),e.stopPropagation()}show(e){e instanceof MouseEvent&&(e.preventDefault(),e.stopPropagation()),this.el.classList.remove("hide");const{x:t,y:i,position:n}=this.calcPosition(e);return this.el.style.transform=`translate(${t}px,${i}px)`,{position:n}}calcPosition(e){var t;const{height:i,width:n}=this.el.getBoundingClientRect();this.height=i,this.width=n;let{x:s,y:o}=e;const l=[v.RIGHT,v.BOTTOM];return 2===(null===(t=e.position)||void 0===t?void 0:t.length)&&(l[0]=e.position[0],l[1]=e.position[1]),l[0]===v.LEFT&&s>n&&(s-=n,l[0]=v.RIGHT),l[0]===v.RIGHT&&d.cW-s<n&&(s=d.cW-n,l[0]=v.LEFT),l[1]===v.TOP&&o>i&&(o-=i,l[1]=v.BOTTOM),l[1]===v.BOTTOM&&d.cH-o<i&&o>=i&&(o-=i,l[1]=v.TOP),{x:s,y:o,position:l}}hide(){this.el.classList.add("hide")}destroy(){this.el.removeEventListener("click",this.eventListenerCb),this.el.removeEventListener("contextmenu",this.eventListenerCb),this.el.remove()}}class M extends m{constructor(e,t){super(e),this.children=[],this.id=(null==t?void 0:t.id)||Math.random().toString(36).slice(2,10),this.menuOption=e,this.level=(null==t?void 0:t.level)||0,this.createUl()}createUl(){var e;this.ul=h("ul",{classList:[n,`${n}-lv${this.level}`],onclick:e=>e.stopPropagation(),oncontextmenu:e=>{e.stopPropagation(),e.preventDefault()}}),null===(e=this.el)||void 0===e||e.appendChild(this.ul)}updateMenuAttr(){var e;this.el.dataset.jaMenuId=this.id,this.el.dataset.lv=this.level.toString(),this.ul.className=`${n} ${n}-lv${this.level} ${c(null===(e=this.menuOption)||void 0===e?void 0:e.class,this.payload)}`}renderMenuItem(){var e,t;if(!Array.isArray(null===(e=this.menuOption)||void 0===e?void 0:e.items))return console.error("option.items is not type of array");let i;for(this.children=[];i=this.ul.lastChild;)i.remove();if(null===(t=this.menuOption)||void 0===t?void 0:t.items)for(const e of this.menuOption.items){const t=new u(this.level,e,this);this.children.push(t),this.ul.appendChild(t.el)}}show(e,t){return this.prepareMenuShow(t),super.show(e)}prepareMenuShow(e){this.payload=e,this.removeAllHover(),this.removeChildMenus(),this.updateMenuAttr(),this.renderMenuItem()}calcPosition(...e){var t;const i=super.calcPosition(...e);let{x:n,y:s}=i;return 0===this.level&&"fixed"!==(null===(t=this.panelOption)||void 0===t?void 0:t.position)&&(n+=window.scrollX,s+=window.scrollY),{x:n,y:s,position:i.position}}closeMenus(e,t=!0){document.querySelectorAll(`.${i}`).forEach((i=>{const n=i.dataset.lv;n&&+n>e&&i.dataset.jaMenuId===this.id?i.remove():t&&i.classList.add("hide")}))}removeAllHover(){this.children.forEach((e=>{e.el.classList.remove(`${n}_hover`)}))}removeChildMenus(){this.closeMenus(this.level,!1)}removeItemHover(){this.children.forEach((e=>{e.el.classList.remove(`${n}_hover`)}))}closeAllMenus(){this.closeMenus(0,!0)}hide(){this.closeAllMenus(),super.hide()}destroy(){super.destroy(),this.menuOption=null,this.children=[],this.payload=void 0}}class f{constructor(e={}){this.storeMenus=[],this.hideMenuEventListener();const t={width:s,fixMenuWhenScroll:!1,hideMenuWhenScroll:!0};this.contextMenuOption=Object.assign(t,e),this.contextMenuOption.hideMenuWhenScroll&&this.scrollListener()}hideMenuEventListener(){window.addEventListener("click",this.clickEventFunc.bind(this),{capture:!0})}clickEventFunc(e){this.storeMenus.forEach((t=>{if(t.el&&!t.el.classList.contains("hide")){let n=!1,s={parentElement:e.target};for(;s=s.parentElement;)if(s.classList.contains(i)){n=!0;break}n||t.hide()}}))}scrollListener(){window.addEventListener("scroll",(()=>{this.hideAllMenu()}))}create(e){p(t,`\n  .${n}{\n    --item-background--hover: #e8e8e9;\n    --disabled-color: #777;\n    --tip-color: #5f6368;\n    --li-height: ${o}px;\n    user-select: none;\n    padding: 2px 0 2px 0px;\n    margin: 0;\n  }\n  /*child menu*/\n  .${n} .${i}{ \n    position: absolute;\n  }\n  \n  .${n} li {\n    position: relative;\n    padding: 0 30px 0 30px;\n    list-style: none;\n    height: var(--li-height);\n    line-height: var(--li-height);\n    font-size: 12px;\n    display: flex;\n    justify-content: space-between;\n  }\n  .${n} li.divide{\n    margin: ${l}px 1px;\n    height: 1px;\n    background-color: var(--border-color);\n  }\n  .${n} li.disabled{\n    color: var(--disabled-color);\n    pointer-events: none;\n  }\n  .${n} li .menu-item-icon{\n    width: 16px;\n    height: 16px;\n    position: absolute;\n    left: 7px; \n    top: calc(calc(var(--li-height) - 16px) / 2);\n  }\n  .${n} li .menu-item-label {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n  .${n} li .menu-item-tip {\n    color: var(--tip-color);\n  }\n  .${n} li:hover:not(.divide):not(.disabled),\n  .${n} li.${n}_hover {\n    background: var(--item-background--hover);\n  }\n  .${n} li .right-arrow {\n    position: absolute;\n    right: 8px; top: 9px;\n    border-top: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-left: 4px solid;\n  }\n  `),e.width||(e.width=this.contextMenuOption.width),this.contextMenuOption.fixMenuWhenScroll&&(e.position="fixed");const s=new M(e);return this.storeMenus.push(s),s.el&&document.body.appendChild(s.el),{show:(e,t)=>this.showMenu(e,s,t),calcPosition:s.calcPosition.bind(s),hide:s.hide.bind(s),destroy:()=>this.destroy(s)}}createAsync(e){let t;return()=>t||(t=this.create(e))}showMenu(e,t,i){return this.hideAllMenu(),t.show(e,i)}hideAllMenu(){this.storeMenus.forEach((e=>e.hide()))}destroy(e){e.destroy(),this.storeMenus=this.storeMenus.filter((t=>e!==t))}}export{m as Panel,f as default,h};
//# sourceMappingURL=ja-contextmenu.esm.min.js.map
