var e="ja-contextmenu-css",t="ja-panel",n="ja-contextmenu",i=200,s=24,o=5,l=5e3;function r(e,t,n){const i=e.match(/^[\w\d]+/);if(!i)throw new Error("invalid tag");const s=i[0],o=e.match(/#[\w\d_-]+/);let l=e.match(/\.[\w\d_-]+/g)||[];l=Array.from(l).map((e=>e.substring(1)));const r=document.createElement(s);if(o&&(r.id=o[0].substring(1)),Array.isArray(t))n=t;else if("object"==typeof t&&null!==t)for(const e in t)if("style"===e||"dataset"===e){const n=t[e];for(const t in n)r[e][t]=n[t]}else"classList"===e&&Array.isArray(t.classList)?l=l.concat(t.classList.filter(Boolean)):r[e]=t[e];else"string"!=typeof t&&"number"!=typeof t||(r.textContent=String(t));return l.length&&r.classList.add(...l),n&&n.forEach((e=>{e&&(e instanceof HTMLElement?r.appendChild(e):console.error(e,"not instance of HTMLElement"))})),r}let h;function d(){const e=document.querySelector("html"),{innerWidth:t,innerHeight:n}=window,{clientWidth:i,clientHeight:s}=e;return h={htmlEl:e,scrollWidth:t-i,scrollHeight:n-s,clientWidth:i,clientHeight:s},h}function a(e,t){return"function"==typeof e?e(t):e||""}d(),window.addEventListener("resize",(()=>{d()}));class c{constructor(e,t,n){this.parentMenu=n,this.level=e,this.itemOption=t,this.init()}init(){const e=this.itemOption;if("hr"===e.type||"---"===e.type)this.el=r("li.divide");else{const t=a(e.disabled,this.parentMenu.payload),n=[a(e.class,this.parentMenu.payload)];t&&n.push("disabled");const i=void 0===e.show||a(e.show,this.parentMenu.payload);let s;if(e.icon){const t=a(e.icon,this.parentMenu.payload);s=t instanceof HTMLElement?r("div.menu-item-icon",[t]):r("img.menu-item-icon",{src:t})}this.el=r("li",{style:{display:i?"":"none"},classList:n,onclick:n=>{var i;if(!t){const t=null===(i=e.onclick)||void 0===i?void 0:i.call(e,n,this.parentMenu.payload);e.children||t||this.parentMenu.closeAllMenus()}},onmouseenter:e.children?e=>{this.showChildMenu(e)}:()=>{this.hideOtherChildMenu()}},[s,e.customItem||r("span.menu-item-label",{textContent:a(e.label,this.parentMenu.payload)}),e.tip&&r("span.menu-item-tip",a(e.tip,this.parentMenu.payload)),e.children&&r("span.right-arrow")])}e.children&&(e.children.width||(e.children.width=this.parentMenu.width),this.childMenu=new u(this.level+1,e.children))}showChildMenu(e){const t=this.childMenu.el;e.target.contains(t)||(e.target.classList.add(n+"_hover"),t.style.display="block"),this.el.appendChild(t),this.childMenu.payload=this.parentMenu.payload,this.childMenu.prepareMenuShow(this.childMenu.payload),this.calcPosition()}calcPosition(){const e=this.childMenu.el,t=e.getBoundingClientRect().height,n=this.el.getBoundingClientRect();let i=this.parentMenu.width-5,o=-2;h.clientWidth-n.x-this.parentMenu.width<this.childMenu.width&&(i=5-this.childMenu.width),h.clientHeight-n.y+2<t&&(o=-t+s+2+1),e.style.transform=`translate(${i}px, ${o}px)`}hideOtherChildMenu(){var e,t;null===(e=this.parentMenu)||void 0===e||e.removeChildMenus(),null===(t=this.parentMenu)||void 0===t||t.removeItemHover()}}class p{constructor(e){var t,n;if(this.height=0,this.panelOption=e,this.width=(null===(t=this.panelOption)||void 0===t?void 0:t.width)||i,"string"==typeof(null===(n=this.panelOption)||void 0===n?void 0:n.width))throw new TypeError("Invalid width type.");this.createEl(),this.addEventListener()}createEl(){var e,n;this.el=r(`div.${t}`,{style:{width:this.width+"px",zIndex:null===(e=this.panelOption)||void 0===e?void 0:e.zIndex,position:null===(n=this.panelOption)||void 0===n?void 0:n.position}})}addEventListener(){var e,t;null===(e=this.el)||void 0===e||e.addEventListener("click",this.eventListenerCb),null===(t=this.el)||void 0===t||t.addEventListener("contextmenu",this.eventListenerCb)}eventListenerCb(e){e.preventDefault(),e.stopPropagation()}show(e){e instanceof MouseEvent&&(e.preventDefault(),e.stopPropagation()),this.el.style.display="block";const{x:t,y:n}=this.calcPosition(e);this.el.style.transform=`translate(${t}px,${n}px)`}calcPosition(e){this.height=this.el.getBoundingClientRect().height;let{x:t,y:n}=e;return h.clientWidth-t<this.width&&(t=h.clientWidth-this.width),h.clientHeight-n<this.height&&(n=e.y-this.height),{x:t,y:n}}hide(){this.el.style.display="none"}destroy(){this.el.removeEventListener("click",this.eventListenerCb),this.el.removeEventListener("contextmenu",this.eventListenerCb),this.el.remove()}}class u extends p{constructor(e,t){super(t),this.children=[],this.menuOption=t,this.level=e,this.createUl()}createUl(){var e;this.ul=r("ul",{classList:[n,`${n}-lv${this.level}`],dataset:{lv:this.level},onclick:e=>e.stopPropagation(),oncontextmenu:e=>{e.stopPropagation(),e.preventDefault()}}),null===(e=this.el)||void 0===e||e.appendChild(this.ul)}updateMenuAttr(){var e;this.ul.className=`${n} ${n}-lv${this.level} ${a(null===(e=this.menuOption)||void 0===e?void 0:e.class,this.payload)}`}renderMenuItem(){var e,t;if(!Array.isArray(null===(e=this.menuOption)||void 0===e?void 0:e.items))return console.error("option.items is not type of array");let n;for(this.children=[];n=this.ul.lastChild;)n.remove();if(null===(t=this.menuOption)||void 0===t?void 0:t.items)for(const e of this.menuOption.items){const t=new c(this.level,e,this);this.children.push(t),this.ul.appendChild(t.el)}}show(e,t){this.prepareMenuShow(t),super.show(e)}prepareMenuShow(e){this.payload=e,this.removeAllHover(),this.removeChildMenus(),this.updateMenuAttr(),this.renderMenuItem()}calcPosition(e){var t;let{x:n,y:i}=super.calcPosition(e);return 0===this.level&&"fixed"!==(null===(t=this.panelOption)||void 0===t?void 0:t.position)&&(n+=window.scrollX,i+=window.scrollY),{x:n,y:i}}removeAllHover(){this.children.forEach((e=>{e.el.classList.remove(`${n}_hover`)}))}removeChildMenus(){this.children.forEach((e=>{var t,n;null===(n=null===(t=e.childMenu)||void 0===t?void 0:t.el)||void 0===n||n.remove()}))}removeItemHover(){this.children.forEach((e=>{e.el.classList.remove(`${n}_hover`)}))}closeAllMenus(){document.querySelectorAll(`.${t}`).forEach((e=>{const t=e.dataset.lv;t&&+t>0?e.remove():e.style.display="none"}))}destroy(){super.destroy(),this.menuOption=null,this.children=[],this.payload=void 0}}const v=`\n  .${t}, .${t} * {\n    box-sizing: border-box;\n  }\n  .${t}{\n    --border-color: #dee0e3;\n    border: 1px solid var(--border-color);\n    left: 0; top: 0;\n    background-color: #fff;\n    display: none;\n    width: ${i}px;\n    position: absolute;\n    z-index: ${l};\n  }\n`,m=`\n  .${n}{\n    --item-background--hover: #e8e8e9;\n    --disabled-color: #777;\n    --tip-color: #5f6368;\n    --li-height: ${s}px;\n    user-select: none;\n    padding: 2px 0 2px 0px;\n    margin: 0;\n  }\n  /*子菜单*/\n  .${n} .${t}{ \n    position: absolute;\n  }\n  \n  .${n} li {\n    position: relative;\n    padding: 0 30px 0 30px;\n    list-style: none;\n    height: var(--li-height);\n    line-height: var(--li-height);\n    font-size: 12px;\n    display: flex;\n    justify-content: space-between;\n  }\n  .${n} li.divide{\n    margin: ${o}px 1px;\n    height: 1px;\n    background-color: var(--border-color);\n  }\n  .${n} li.disabled{\n    color: var(--disabled-color);\n    pointer-events: none;\n  }\n  .${n} li .menu-item-icon{\n    width: 16px;\n    height: 16px;\n    position: absolute;\n    left: 7px; \n    top: calc(calc(var(--li-height) - 16px) / 2);\n  }\n  .${n} li .menu-item-label {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n  .${n} li .menu-item-tip {\n    color: var(--tip-color);\n  }\n  .${n} li:hover:not(.divide):not(.disabled),\n  .${n} li.${n}_hover {\n    background: var(--item-background--hover);\n  }\n  .${n} li .right-arrow {\n    position: absolute;\n    right: 8px; top: 9px;\n    border-top: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-left: 4px solid;\n  }\n  `;class y{constructor(e={}){this.storeMenus=[],this.injectCss(),this.hideMenuEventListener();const t={width:i,fixMenuWhenScroll:!1,hideMenuWhenScroll:!0};this.contextMenuOption=Object.assign(t,e),this.contextMenuOption.hideMenuWhenScroll&&this.scrollListener()}injectCss(){const t=document.querySelector("head title");let n=document.querySelector(`#${e}`);n||(n=r(`style#${e}`,{innerHTML:v+m}),t?document.head.insertBefore(n,t.nextElementSibling):document.head.appendChild(n))}hideMenuEventListener(){window.addEventListener("click",this.clickEventFunc.bind(this),{capture:!0})}clickEventFunc(e){this.storeMenus.forEach((t=>{if(t.el&&"block"===t.el.style.display){let n=!1,i={parentElement:e.target};for(;i=i.parentElement;)if(i===t.el){n=!0;break}n||t.hide()}}))}scrollListener(){window.addEventListener("scroll",(()=>{this.hideAllMenu()}))}create(e){e.width||(e.width=this.contextMenuOption.width),this.contextMenuOption.fixMenuWhenScroll&&(e.position="fixed");const t=new u(0,e);return this.storeMenus.push(t),t.el&&document.body.appendChild(t.el),{show:(e,n)=>this.showMenu(e,t,n),hide:()=>t.hide(),destroy:()=>this.destroy(t)}}showMenu(e,t,n){this.hideAllMenu(),t.show(e,n)}hideAllMenu(){this.storeMenus.forEach((e=>e.hide()))}destroy(e){e.destroy(),this.storeMenus=this.storeMenus.filter((t=>e!==t))}}export{p as Panel,y as default,r as h};
//# sourceMappingURL=ja-contextmenu.esm.min.js.map
