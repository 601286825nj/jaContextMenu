var e={panelCssId:"ja-panel-css",contextMenuCssId:"ja-contextmenu-css",panelClassName:"ja-panel",wrapperClassName:"ja-contextmenu",defaultMenuWidth:200,menuItemHeight:24,menuItemDivideLineMargin:5,defaultZIndex:5e3};function t(e,t,n){const i=e.match(/^[\w\d]+/);if(!i)throw new Error("invalid tag");const s=i[0],l=e.match(/#[\w\d_-]+/);let o=e.match(/\.[\w\d_-]+/g)||[];o=Array.from(o).map((e=>e.substring(1)));const r=document.createElement(s);if(l&&(r.id=l[0].substring(1)),Array.isArray(t))n=t;else if("object"==typeof t&&null!==t)for(const e in t)if("style"===e||"dataset"===e){const n=t[e];for(const t in n)r[e][t]=n[t]}else"classList"===e&&Array.isArray(t.classList)?o=o.concat(t.classList.filter(Boolean)):r[e]=t[e];else"string"!=typeof t&&"number"!=typeof t||(r.textContent=String(t));return o.length&&r.classList.add(...o),n&&n.forEach((e=>{e&&(e instanceof HTMLElement?r.appendChild(e):console.error(e,"not instance of HTMLElement"))})),r}let n;function i(){const e=document.querySelector("html"),{innerWidth:t,innerHeight:i}=window,{clientWidth:s,clientHeight:l}=e;return n={htmlEl:e,scrollWidth:t-s,scrollHeight:i-l,clientWidth:s,clientHeight:l},n}function s(e,t){return"function"==typeof e?e(t):e||""}function l(n,i){let s=document.getElementById(n);if(!s){s=t(`style#${e.contextMenuCssId}`,{innerHTML:i});const n=document.querySelector("head title");n?document.head.insertBefore(s,n.nextElementSibling):document.head.appendChild(s)}}i(),window.addEventListener("resize",(()=>{i()}));class o{constructor(e,t,n){this.parentMenu=n,this.level=e,this.itemOption=t,this.init()}init(){const e=this.itemOption;if("hr"===e.type||"---"===e.type)this.el=t("li.divide");else{const n=s(e.disabled,this.parentMenu.payload),i=[s(e.class,this.parentMenu.payload)];n&&i.push("disabled");const l=void 0===e.show||s(e.show,this.parentMenu.payload);let o;if(e.icon){const n=s(e.icon,this.parentMenu.payload);o=n instanceof HTMLElement?t("div.menu-item-icon",[n]):t("img.menu-item-icon",{src:n})}this.el=t("li",{style:{display:l?"":"none"},classList:i,onclick:t=>{var i;if(!n){const n=null===(i=e.onclick)||void 0===i?void 0:i.call(e,t,this.parentMenu.payload);e.children||n||this.parentMenu.closeAllMenus()}},onmouseenter:e.children?e=>{this.showChildMenu(e)}:()=>{this.hideOtherChildMenu()}},[o,e.customItem||t("span.menu-item-label",{textContent:s(e.label,this.parentMenu.payload)}),e.tip&&t("span.menu-item-tip",s(e.tip,this.parentMenu.payload)),e.children&&t("span.right-arrow")])}e.children&&(e.children.width||(e.children.width=this.parentMenu.width),this.childMenu=new d(this.level+1,e.children))}showChildMenu(t){const n=this.childMenu.el;t.target.contains(n)||(t.target.classList.add(e.wrapperClassName+"_hover"),n.style.display="block"),this.el.appendChild(n),this.childMenu.payload=this.parentMenu.payload,this.childMenu.prepareMenuShow(this.childMenu.payload),this.calcPosition()}calcPosition(){const t=this.childMenu.el,i=t.getBoundingClientRect().height,s=this.el.getBoundingClientRect();let l=this.parentMenu.width-5,o=-2;n.clientWidth-s.x-this.parentMenu.width<this.childMenu.width&&(l=5-this.childMenu.width),n.clientHeight-s.y+2<i&&(o=-i+e.menuItemHeight+2+1),t.style.transform=`translate(${l}px, ${o}px)`}hideOtherChildMenu(){var e,t;null===(e=this.parentMenu)||void 0===e||e.removeChildMenus(),null===(t=this.parentMenu)||void 0===t||t.removeItemHover()}}const r=`\n  .${e.panelClassName}, .${e.panelClassName} * {\n    box-sizing: border-box;\n  }\n  .${e.panelClassName}{\n    --border-color: #dee0e3;\n    border: 1px solid var(--border-color);\n    left: 0; top: 0;\n    background-color: #fff;\n    display: none;\n    width: ${e.defaultMenuWidth}px;\n    position: absolute;\n    z-index: ${e.defaultZIndex};\n  }\n`,a=`\n  .${e.wrapperClassName}{\n    --item-background--hover: #e8e8e9;\n    --disabled-color: #777;\n    --tip-color: #5f6368;\n    --li-height: ${e.menuItemHeight}px;\n    user-select: none;\n    padding: 2px 0 2px 0px;\n    margin: 0;\n  }\n  /*子菜单*/\n  .${e.wrapperClassName} .${e.panelClassName}{ \n    position: absolute;\n  }\n  \n  .${e.wrapperClassName} li {\n    position: relative;\n    padding: 0 30px 0 30px;\n    list-style: none;\n    height: var(--li-height);\n    line-height: var(--li-height);\n    font-size: 12px;\n    display: flex;\n    justify-content: space-between;\n  }\n  .${e.wrapperClassName} li.divide{\n    margin: ${e.menuItemDivideLineMargin}px 1px;\n    height: 1px;\n    background-color: var(--border-color);\n  }\n  .${e.wrapperClassName} li.disabled{\n    color: var(--disabled-color);\n    pointer-events: none;\n  }\n  .${e.wrapperClassName} li .menu-item-icon{\n    width: 16px;\n    height: 16px;\n    position: absolute;\n    left: 7px; \n    top: calc(calc(var(--li-height) - 16px) / 2);\n  }\n  .${e.wrapperClassName} li .menu-item-label {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n  .${e.wrapperClassName} li .menu-item-tip {\n    color: var(--tip-color);\n  }\n  .${e.wrapperClassName} li:hover:not(.divide):not(.disabled),\n  .${e.wrapperClassName} li.${e.wrapperClassName}_hover {\n    background: var(--item-background--hover);\n  }\n  .${e.wrapperClassName} li .right-arrow {\n    position: absolute;\n    right: 8px; top: 9px;\n    border-top: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-left: 4px solid;\n  }\n  `;class h{constructor(t){var n,i;if(this.height=0,this.panelOption=t,this.width=(null===(n=this.panelOption)||void 0===n?void 0:n.width)||e.defaultMenuWidth,"string"==typeof(null===(i=this.panelOption)||void 0===i?void 0:i.width))throw new TypeError("Invalid width type.");l(e.panelCssId,r),this.createEl(),this.addEventListener()}createEl(){var n,i;this.el=t(`div.${e.panelClassName}`,{style:{width:this.width+"px",zIndex:null===(n=this.panelOption)||void 0===n?void 0:n.zIndex,position:null===(i=this.panelOption)||void 0===i?void 0:i.position}})}addEventListener(){var e,t;null===(e=this.el)||void 0===e||e.addEventListener("click",this.eventListenerCb),null===(t=this.el)||void 0===t||t.addEventListener("contextmenu",this.eventListenerCb)}eventListenerCb(e){e.preventDefault(),e.stopPropagation()}show(e){e instanceof MouseEvent&&(e.preventDefault(),e.stopPropagation()),this.el.style.display="block";const{x:t,y:n}=this.calcPosition(e);this.el.style.transform=`translate(${t}px,${n}px)`}calcPosition(e){this.height=this.el.getBoundingClientRect().height;let{x:t,y:i}=e;return n.clientWidth-t<this.width&&(t=n.clientWidth-this.width),n.clientHeight-i<this.height&&(i=e.y-this.height),{x:t,y:i}}hide(){this.el.style.display="none"}destroy(){this.el.removeEventListener("click",this.eventListenerCb),this.el.removeEventListener("contextmenu",this.eventListenerCb),this.el.remove()}}class d extends h{constructor(e,t){super(t),this.children=[],this.menuOption=t,this.level=e,this.createUl()}createUl(){var n;this.ul=t("ul",{classList:[e.wrapperClassName,`${e.wrapperClassName}-lv${this.level}`],dataset:{lv:this.level},onclick:e=>e.stopPropagation(),oncontextmenu:e=>{e.stopPropagation(),e.preventDefault()}}),null===(n=this.el)||void 0===n||n.appendChild(this.ul)}updateMenuAttr(){var t;this.ul.className=`${e.wrapperClassName} ${e.wrapperClassName}-lv${this.level} ${s(null===(t=this.menuOption)||void 0===t?void 0:t.class,this.payload)}`}renderMenuItem(){var e,t;if(!Array.isArray(null===(e=this.menuOption)||void 0===e?void 0:e.items))return console.error("option.items is not type of array");let n;for(this.children=[];n=this.ul.lastChild;)n.remove();if(null===(t=this.menuOption)||void 0===t?void 0:t.items)for(const e of this.menuOption.items){const t=new o(this.level,e,this);this.children.push(t),this.ul.appendChild(t.el)}}show(e,t){this.prepareMenuShow(t),super.show(e)}prepareMenuShow(e){this.payload=e,this.removeAllHover(),this.removeChildMenus(),this.updateMenuAttr(),this.renderMenuItem()}calcPosition(e){var t;let{x:n,y:i}=super.calcPosition(e);return 0===this.level&&"fixed"!==(null===(t=this.panelOption)||void 0===t?void 0:t.position)&&(n+=window.scrollX,i+=window.scrollY),{x:n,y:i}}removeAllHover(){this.children.forEach((t=>{t.el.classList.remove(`${e.wrapperClassName}_hover`)}))}removeChildMenus(){this.children.forEach((e=>{var t,n;null===(n=null===(t=e.childMenu)||void 0===t?void 0:t.el)||void 0===n||n.remove()}))}removeItemHover(){this.children.forEach((t=>{t.el.classList.remove(`${e.wrapperClassName}_hover`)}))}closeAllMenus(){document.querySelectorAll(`.${e.panelClassName}`).forEach((e=>{const t=e.dataset.lv;t&&+t>0?e.remove():e.style.display="none"}))}destroy(){super.destroy(),this.menuOption=null,this.children=[],this.payload=void 0}}class p{constructor(t={}){this.storeMenus=[],this.hideMenuEventListener();const n={width:e.defaultMenuWidth,fixMenuWhenScroll:!1,hideMenuWhenScroll:!0};this.contextMenuOption=Object.assign(n,t),this.contextMenuOption.hideMenuWhenScroll&&this.scrollListener()}hideMenuEventListener(){window.addEventListener("click",this.clickEventFunc.bind(this),{capture:!0})}clickEventFunc(e){this.storeMenus.forEach((t=>{if(t.el&&"block"===t.el.style.display){let n=!1,i={parentElement:e.target};for(;i=i.parentElement;)if(i===t.el){n=!0;break}n||t.hide()}}))}scrollListener(){window.addEventListener("scroll",(()=>{this.hideAllMenu()}))}create(t){l(e.contextMenuCssId,a),t.width||(t.width=this.contextMenuOption.width),this.contextMenuOption.fixMenuWhenScroll&&(t.position="fixed");const n=new d(0,t);return this.storeMenus.push(n),n.el&&document.body.appendChild(n.el),{show:(e,t)=>this.showMenu(e,n,t),hide:()=>n.hide(),destroy:()=>this.destroy(n)}}createAsync(e){let t;return()=>t||(t=this.create(e))}showMenu(e,t,n){this.hideAllMenu(),t.show(e,n)}hideAllMenu(){this.storeMenus.forEach((e=>e.hide()))}destroy(e){e.destroy(),this.storeMenus=this.storeMenus.filter((t=>e!==t))}}export{h as Panel,p as default,t as h};
//# sourceMappingURL=ja-contextmenu.esm.min.js.map
