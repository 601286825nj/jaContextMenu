var e="ja-panel-css",t="ja-contextmenu-css",n="ja-panel",i="ja-contextmenu",o=200,s=24,l=5,r=5e3;function h(e,t,n){const i=e.match(/^[\w\d]+/);if(!i)throw new Error("invalid tag");const o=i[0],s=e.match(/#[\w\d_-]+/);let l=e.match(/\.[\w\d_-]+/g)||[];l=Array.from(l).map((e=>e.substring(1)));const r=document.createElement(o);if(s&&(r.id=s[0].substring(1)),Array.isArray(t))n=t;else if("object"==typeof t&&null!==t)for(const e in t)if("style"===e||"dataset"===e){const n=t[e];for(const t in n)r[e][t]=n[t]}else"classList"===e&&Array.isArray(t.classList)?l=l.concat(t.classList.filter(Boolean)):r[e]=t[e];else"string"!=typeof t&&"number"!=typeof t||(r.textContent=String(t));return l.length&&r.classList.add(...l),n&&n.forEach((e=>{e&&(e instanceof HTMLElement?r.appendChild(e):console.error(e,"not instance of HTMLElement"))})),r}let d;function a(){const e=document.querySelector("html"),{innerWidth:t,innerHeight:n}=window,{clientWidth:i,clientHeight:o}=e;return d={htmlEl:e,sW:t-i,sH:n-o,cW:i,cH:o},d}function c(e,t){return"function"==typeof e?e(t):e||""}function p(e,t){let n=document.getElementById(e);if(!n){n=h(`style#${e}`,{innerHTML:t});const i=document.querySelector("head title");i?document.head.insertBefore(n,i.nextElementSibling):document.head.appendChild(n)}}a(),window.addEventListener("resize",(()=>{a()}));class u{constructor(e,t,n){this.parentMenu=n,this.level=e,this.itemOption=t,this.init()}init(){const e=this.itemOption;if("hr"===e.type||"---"===e.type)this.el=h("li.divide");else{const t=c(e.disabled,this.parentMenu.payload),n=[c(e.class,this.parentMenu.payload)];t&&n.push("disabled");const i=void 0===e.show||c(e.show,this.parentMenu.payload);let o;if(e.icon){const t=c(e.icon,this.parentMenu.payload);o=t instanceof HTMLElement?h("div.menu-item-icon",[t]):h("img.menu-item-icon",{src:t})}this.el=h("li",{style:{display:i?"":"none"},classList:n,onclick:n=>{var i;if(!t){const t=null===(i=e.onclick)||void 0===i?void 0:i.call(e,n,this.parentMenu.payload);e.children||t||this.parentMenu.closeAllMenus()}},onmouseenter:e.children?e=>{this.showChildMenu(e)}:()=>{this.hideOtherChildMenu()}},[o,e.customItem||h("span.menu-item-label",{textContent:c(e.label,this.parentMenu.payload)}),e.tip&&h("span.menu-item-tip",c(e.tip,this.parentMenu.payload)),e.children&&h("span.right-arrow")])}e.children&&(e.children.width||(e.children.width=this.parentMenu.width),this.childMenu=new f(this.level+1,e.children))}showChildMenu(e){const t=this.childMenu.el;e.target.contains(t)||(e.target.classList.add(i+"_hover"),t.classList.remove("hide")),this.el.appendChild(t),this.childMenu.payload=this.parentMenu.payload,this.childMenu.prepareMenuShow(this.childMenu.payload),this.calcPosition()}calcPosition(){const e=this.childMenu.el,t=e.getBoundingClientRect().height,n=this.el.getBoundingClientRect(),i=this.parentMenu.width||o,l=this.childMenu.width||o;let r=i-5,h=-2;d.cW-n.x-i<i&&(r=5-l),d.cH-n.y+2<t&&(h=-t+s+2+1),e.style.transform=`translate(${r}px, ${h}px)`}hideOtherChildMenu(){var e,t;null===(e=this.parentMenu)||void 0===e||e.removeChildMenus(),null===(t=this.parentMenu)||void 0===t||t.removeItemHover()}}var v;!function(e){e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right"}(v||(v={}));class m{constructor(t){var i,o;if(this.height=0,this.panelOption=t,this.width=null===(i=this.panelOption)||void 0===i?void 0:i.width,"string"==typeof(null===(o=this.panelOption)||void 0===o?void 0:o.width))throw new TypeError("Invalid width type.");p(e,`\n  .${n}, .${n} * {\n    box-sizing: border-box;\n  }\n  .${n}{\n    --border-color: #dee0e3;\n    border: 1px solid var(--border-color);\n    left: 0; top: 0;\n    background-color: #fff;\n    position: absolute;\n    z-index: ${r};\n  }\n  .${n}.hide{\n    display: none;\n  }\n`),this.createEl(),this.addEventListener()}createEl(){var e,t;this.el=h(`div.${n}`,{style:{width:this.width?this.width+"px":void 0,zIndex:null===(e=this.panelOption)||void 0===e?void 0:e.zIndex,position:null===(t=this.panelOption)||void 0===t?void 0:t.position},classList:["hide"]})}addEventListener(){var e,t;null===(e=this.el)||void 0===e||e.addEventListener("click",this.eventListenerCb),null===(t=this.el)||void 0===t||t.addEventListener("contextmenu",this.eventListenerCb)}eventListenerCb(e){e.preventDefault(),e.stopPropagation()}show(e){e instanceof MouseEvent&&(e.preventDefault(),e.stopPropagation()),this.el.classList.remove("hide");const{x:t,y:n,position:i}=this.calcPosition(e);return this.el.style.transform=`translate(${t}px,${n}px)`,{position:i}}calcPosition(e){var t;const{height:n,width:i}=this.el.getBoundingClientRect();this.height=n,this.width=i;let{x:o,y:s}=e;const l=[v.RIGHT,v.BOTTOM];return 2===(null===(t=e.position)||void 0===t?void 0:t.length)&&(l[0]=e.position[0],l[1]=e.position[1]),l[0]===v.LEFT&&o>i&&(o-=i,l[0]=v.RIGHT),l[0]===v.RIGHT&&d.cW-o<i&&(o=d.cW-i,l[0]=v.LEFT),l[1]===v.TOP&&s>n&&(s-=n,l[1]=v.BOTTOM),l[1]===v.BOTTOM&&d.cH-s<n&&s>=n&&(s-=n,l[1]=v.TOP),{x:o,y:s,position:l}}hide(){this.el.classList.add("hide")}destroy(){this.el.removeEventListener("click",this.eventListenerCb),this.el.removeEventListener("contextmenu",this.eventListenerCb),this.el.remove()}}class f extends m{constructor(e,t){super(t),this.children=[],this.menuOption=t,this.level=e,this.createUl()}createUl(){var e;this.ul=h("ul",{classList:[i,`${i}-lv${this.level}`],dataset:{lv:this.level},onclick:e=>e.stopPropagation(),oncontextmenu:e=>{e.stopPropagation(),e.preventDefault()}}),null===(e=this.el)||void 0===e||e.appendChild(this.ul)}updateMenuAttr(){var e;this.ul.className=`${i} ${i}-lv${this.level} ${c(null===(e=this.menuOption)||void 0===e?void 0:e.class,this.payload)}`}renderMenuItem(){var e,t;if(!Array.isArray(null===(e=this.menuOption)||void 0===e?void 0:e.items))return console.error("option.items is not type of array");let n;for(this.children=[];n=this.ul.lastChild;)n.remove();if(null===(t=this.menuOption)||void 0===t?void 0:t.items)for(const e of this.menuOption.items){const t=new u(this.level,e,this);this.children.push(t),this.ul.appendChild(t.el)}}show(e,t){return this.prepareMenuShow(t),super.show(e)}prepareMenuShow(e){this.payload=e,this.removeAllHover(),this.removeChildMenus(),this.updateMenuAttr(),this.renderMenuItem()}calcPosition(...e){var t;const n=super.calcPosition(...e);let{x:i,y:o}=n;return 0===this.level&&"fixed"!==(null===(t=this.panelOption)||void 0===t?void 0:t.position)&&(i+=window.scrollX,o+=window.scrollY),{x:i,y:o,position:n.position}}removeAllHover(){this.children.forEach((e=>{e.el.classList.remove(`${i}_hover`)}))}removeChildMenus(){this.children.forEach((e=>{var t,n;null===(n=null===(t=e.childMenu)||void 0===t?void 0:t.el)||void 0===n||n.remove()}))}removeItemHover(){this.children.forEach((e=>{e.el.classList.remove(`${i}_hover`)}))}closeAllMenus(){document.querySelectorAll(`.${n}`).forEach((e=>{const t=e.dataset.lv;t&&+t>0?e.remove():e.classList.add("hide")}))}destroy(){super.destroy(),this.menuOption=null,this.children=[],this.payload=void 0}}class M{constructor(e={}){this.storeMenus=[],this.hideMenuEventListener();const t={width:o,fixMenuWhenScroll:!1,hideMenuWhenScroll:!0};this.contextMenuOption=Object.assign(t,e),this.contextMenuOption.hideMenuWhenScroll&&this.scrollListener()}hideMenuEventListener(){window.addEventListener("click",this.clickEventFunc.bind(this),{capture:!0})}clickEventFunc(e){this.storeMenus.forEach((t=>{if(t.el&&!t.el.classList.contains("hide")){let n=!1,i={parentElement:e.target};for(;i=i.parentElement;)if(i===t.el){n=!0;break}n||t.hide()}}))}scrollListener(){window.addEventListener("scroll",(()=>{this.hideAllMenu()}))}create(e){p(t,`\n  .${i}{\n    --item-background--hover: #e8e8e9;\n    --disabled-color: #777;\n    --tip-color: #5f6368;\n    --li-height: ${s}px;\n    user-select: none;\n    padding: 2px 0 2px 0px;\n    margin: 0;\n  }\n  /*child menu*/\n  .${i} .${n}{ \n    position: absolute;\n  }\n  \n  .${i} li {\n    position: relative;\n    padding: 0 30px 0 30px;\n    list-style: none;\n    height: var(--li-height);\n    line-height: var(--li-height);\n    font-size: 12px;\n    display: flex;\n    justify-content: space-between;\n  }\n  .${i} li.divide{\n    margin: ${l}px 1px;\n    height: 1px;\n    background-color: var(--border-color);\n  }\n  .${i} li.disabled{\n    color: var(--disabled-color);\n    pointer-events: none;\n  }\n  .${i} li .menu-item-icon{\n    width: 16px;\n    height: 16px;\n    position: absolute;\n    left: 7px; \n    top: calc(calc(var(--li-height) - 16px) / 2);\n  }\n  .${i} li .menu-item-label {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n  .${i} li .menu-item-tip {\n    color: var(--tip-color);\n  }\n  .${i} li:hover:not(.divide):not(.disabled),\n  .${i} li.${i}_hover {\n    background: var(--item-background--hover);\n  }\n  .${i} li .right-arrow {\n    position: absolute;\n    right: 8px; top: 9px;\n    border-top: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-left: 4px solid;\n  }\n  `),e.width||(e.width=this.contextMenuOption.width),this.contextMenuOption.fixMenuWhenScroll&&(e.position="fixed");const o=new f(0,e);return this.storeMenus.push(o),o.el&&document.body.appendChild(o.el),{show:(e,t)=>this.showMenu(e,o,t),calcPosition:o.calcPosition.bind(o),hide:o.hide.bind(o),destroy:()=>this.destroy(o)}}createAsync(e){let t;return()=>t||(t=this.create(e))}showMenu(e,t,n){return this.hideAllMenu(),t.show(e,n)}hideAllMenu(){this.storeMenus.forEach((e=>e.hide()))}destroy(e){e.destroy(),this.storeMenus=this.storeMenus.filter((t=>e!==t))}}export{m as Panel,M as default,h};
//# sourceMappingURL=ja-contextmenu.esm.min.js.map
