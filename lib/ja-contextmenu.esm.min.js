function e(e,t,n){const i=e.match(/#[\w\d_-]+/);let s=e.match(/\.[\w\d_-]+/g)||[];s=Array.from(s).map((e=>e.substring(1))),e=e.match(/^[\w\d]+/)[0];const l=document.createElement(e);if(i&&(l.id=i[0].substring(1)),Array.isArray(t))n=t;else if("object"==typeof t&&null!==t)for(const e in t)if("style"===e||"dataset"===e)for(const n in t[e])l[e][n]=t[e][n];else"classList"===e&&Array.isArray(t.classList)?s=s.concat(t.classList.filter(Boolean)):l[e]=t[e];else"string"!=typeof t&&"number"!=typeof t||(l.textContent=String(t));return s.length&&l.classList.add(...s),n&&n.forEach((e=>{e&&(e instanceof HTMLElement?l.appendChild(e):console.error(e,"not instance of HTMLElement"))})),l}var t="ja-contextmenu-css",n="ja-panel",i="ja-contextmenu",s=200,l=24,o=5,r=5e3;let h;function d(){const e=document.querySelector("html"),{innerWidth:t,innerHeight:n}=window,{clientWidth:i,clientHeight:s}=e;return h={htmlEl:e,scrollWidth:t-i,scrollHeight:n-s,clientWidth:i,clientHeight:s},h}function a(e,t){return"function"==typeof e?e(t):e||""}d(),window.addEventListener("resize",(()=>{d()}));class c{constructor(e,t,n){this.parentMenu=n,this.level=e,this.itemOption=t,this.init()}init(){const t=this.itemOption;if("hr"===t.type||"---"===t.type)this.el=e("li.divide");else{const n=a(t.disabled,this.parentMenu.payload),i=[a(t.class,this.parentMenu.payload)];n&&i.push("disabled"),this.el=e("li",{classList:i,onclick:e=>{var i;n||(null===(i=t.onclick)||void 0===i||i.call(t,e,this.parentMenu.payload),t.children||this.parentMenu.closeAllMenus())},onmouseenter:t.children?e=>{this.showChildMenu(e)}:()=>{this.hideOtherChildMenu()}},[t.icon&&e("img.menu-item-icon",{src:a(t.icon,this.parentMenu.payload)}),t.customItem||e("span.menu-item-label",{textContent:a(t.label,this.parentMenu.payload)}),t.tip&&e("span.menu-item-tip",a(t.tip,this.parentMenu.payload)),t.children&&e("span.right-arrow")])}t.children&&(t.children.width||(t.children.width=this.parentMenu.width),this.childMenu=new u(this.level+1,t.children))}showChildMenu(e){const t=this.childMenu.el;e.target.contains(t)||(e.target.classList.add(i+"_hover"),t.style.display="block"),this.el.appendChild(t),this.childMenu.payload=this.parentMenu.payload,this.childMenu.show(e,this.childMenu.payload),this.calcPosition()}calcPosition(){const e=this.childMenu.el,t=e.getBoundingClientRect().height,n=this.el.getBoundingClientRect();let i=this.parentMenu.width-5,s=-2;h.clientWidth-n.x-this.parentMenu.width<this.childMenu.width&&(i=5-this.childMenu.width),h.clientHeight-n.y+2<t&&(s=-t+l+2+1),e.style.transform=`translate(${i}px, ${s}px)`}hideOtherChildMenu(){var e,t;null===(e=this.parentMenu)||void 0===e||e.removeChildMenus(),null===(t=this.parentMenu)||void 0===t||t.removeItemHover()}}class p{constructor(e){var t;this.height=0,this.panelOption=e,this.width=(null===(t=this.panelOption)||void 0===t?void 0:t.width)||s,this.createEl(),this.addEventListener()}createEl(){var t,i;this.el=e(`div.${n}`,{style:{width:this.width+"px",zIndex:null===(t=this.panelOption)||void 0===t?void 0:t.zIndex,position:null===(i=this.panelOption)||void 0===i?void 0:i.position}})}addEventListener(){this.el.addEventListener("click",this.eventListenerCb),this.el.addEventListener("contextmenu",this.eventListenerCb)}eventListenerCb(e){e.preventDefault(),e.stopPropagation()}show(e){e instanceof MouseEvent&&(e.preventDefault(),e.stopPropagation()),this.el.style.display="block";const{x:t,y:n}=this.calcPosition(e);this.el.style.transform=`translate(${t}px,${n}px)`}calcPosition(e){this.height=parseFloat(getComputedStyle(this.el).height);let{x:t,y:n}=e;return h.clientWidth-t<this.width&&(t=h.clientWidth-this.width),h.clientHeight-n<this.height&&(n=e.y-this.height),{x:t,y:n}}hide(){this.el.style.display="none"}destroy(){this.el.removeEventListener("click",this.eventListenerCb),this.el.removeEventListener("contextmenu",this.eventListenerCb),this.el.remove()}}class u extends p{constructor(e,t){super(t),this.children=[],this.menuOption=t,this.level=e,this.createUl()}createUl(){this.ul=e("ul",{classList:[i,`${i}-lv${this.level}`],dataset:{lv:this.level},onclick:e=>e.stopPropagation(),oncontextmenu:e=>{e.stopPropagation(),e.preventDefault()}}),this.el.appendChild(this.ul)}updateMenuAttr(){this.ul.className=`${i} ${i}-lv${this.level} ${a(this.menuOption.class,this.payload)}`}renderMenuItem(){if(!Array.isArray(this.menuOption.items))return console.error("option.items is not type of array");let e;for(this.children=[];e=this.ul.lastChild;)e.remove();for(const e of this.menuOption.items)this.children.push(new c(this.level,e,this));this.children.forEach((e=>{this.ul.appendChild(e.el)}))}show(e,t){this.payload=t,this.removeAllHover(),this.removeChildMenus(),this.updateMenuAttr(),this.renderMenuItem(),super.show(e)}calcPosition(e){let{x:t,y:n}=super.calcPosition(e);return 0===this.level&&"fixed"!==this.panelOption.position&&(t+=window.scrollX,n+=window.scrollY),{x:t,y:n}}removeAllHover(){this.children.forEach((e=>{e.el.classList.remove(`${i}_hover`)}))}removeChildMenus(){this.children.forEach((e=>{var t;null===(t=e.childMenu)||void 0===t||t.el.remove()}))}removeItemHover(){this.children.forEach((e=>{e.el.classList.remove(`${i}_hover`)}))}closeAllMenus(){document.querySelectorAll(`.${n}`).forEach((e=>{+e.dataset.lv>0?e.remove():e.style.display="none"}))}destroy(){this.el.remove(),this.el=null,this.menuOption=null,this.children=[],this.payload=null}}const v=`\n  .${n}, .${n} * {\n    box-sizing: border-box;\n  }\n  .${n}{\n    --border-color: #dee0e3;\n    border: 1px solid var(--border-color);\n    left: 0; top: 0;\n    background-color: #fff;\n    display: none;\n    width: ${s}px;\n    position: absolute;\n    z-index: ${r};\n  }\n`,m=`\n  .${i}{\n    user-select: none;\n    padding: 2px 0 2px 0px;\n    margin: 0;\n  }\n  /*子菜单*/\n  .${i} .${n}{ \n    position: absolute;\n  }\n  .${i} .divide{\n    margin: ${o}px 1px;\n    height: 1px;\n    background-color: var(--border-color);\n  }\n  .${i} li {\n    position: relative;\n    padding: 0 30px 0 30px;\n    list-style: none;\n    line-height: ${l}px;\n    font-size: 12px;\n    display: flex;\n    justify-content: space-between;\n  }\n  .${i} li.disabled{\n    color: #5f6368;\n    pointer-events: none;\n  }\n  .${i} li .menu-item-icon{\n    position: absolute;\n    left: 7px; top: 4px;\n    width: 16px;\n    height: 16px;\n  }\n  .${i} li .menu-item-label {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .${i} li .menu-item-tip {\n    color: #5f6368;\n  }\n  .${i} li:hover:not(.divide):not(.disabled),\n  .${i} li.${i}_hover {\n    background-color: #e8e8e9;\n  }\n  .${i} li .right-arrow {\n    position: absolute;\n    right: 8px; top: 9px;\n    border-top: 4px solid transparent;\n    border-right: 4px solid transparent;\n    border-bottom: 4px solid transparent;\n    border-left: 4px solid #000;\n  }\n  `;class y{constructor(e={}){this.storeMenus=[],this.injectCss(),this.hideMenuEventListener();const t={width:s,fixMenuWhenScroll:!1,hideMenuWhenScroll:!0};this.contextMenuOption=Object.assign(t,e),this.contextMenuOption.hideMenuWhenScroll&&this.scrollListener()}injectCss(){const n=document.querySelector("head title");let i=document.querySelector(`#${t}`);i||(i=e(`style#${t}`,{innerHTML:v+m}),n?document.head.insertBefore(i,n.nextElementSibling):document.head.appendChild(i))}hideMenuEventListener(){window.addEventListener("click",this.clickEventFunc.bind(this),{capture:!0})}clickEventFunc(e){this.storeMenus.forEach((t=>{if("block"===t.el.style.display){let n=!1,i={parentElement:e.target};for(;i=i.parentElement;)if(i===t.el){n=!0;break}n||t.hide()}}))}scrollListener(){window.addEventListener("scroll",(()=>{this.hideAllMenu()}))}create(e){e.width||(e.width=this.contextMenuOption.width),this.contextMenuOption.fixMenuWhenScroll&&(e.position="fixed");const t=new u(0,e);return this.storeMenus.push(t),document.body.appendChild(t.el),{show:(e,n)=>this.showMenu(e,t,n),hide:()=>t.hide(),destroy:()=>this.destroy(t)}}showMenu(e,t,n){this.hideAllMenu(),t.show(e,n)}hideAllMenu(){this.storeMenus.forEach((e=>e.hide()))}destroy(e){e.destroy(),this.storeMenus=this.storeMenus.filter((t=>e!==t))}}export{p as Panel,y as default,e as h};
//# sourceMappingURL=ja-contextmenu.esm.min.js.map
